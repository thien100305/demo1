<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω sinh vi√™n - School Manager</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 900px; }
        .table-container { background: white; padding: 20px; border-radius: 10px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="container mt-4">

    <h3 class="text-primary text-center mb-4">DANH S√ÅCH SINH VI√äN</h3>

    <div class="mb-3">
        <input type="text" id="search" class="form-control" 
               placeholder="üîç T√¨m theo t√™n sinh vi√™n..." onkeyup="searchStudent()">
    </div>

    <div class="table-container shadow-sm mb-5">
        <table class="table table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>H·ªç v√† T√™n</th>
                    <th>Email</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody id="studentTable">
                </tbody>
        </table>
    </div>

    <hr>

    <div class="card p-4 shadow-sm mb-5 border-0 bg-light">
        <h4 id="formTitle" class="mb-3">Th√™m sinh vi√™n m·ªõi</h4>
        <input type="hidden" id="studentId"> 
        
        <div class="mb-3">
            <label class="form-label fw-bold">H·ªç v√† t√™n:</label>
            <input id="name" class="form-control" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn An">
        </div>
        <div class="mb-3">
            <label class="form-label fw-bold">ƒê·ªãa ch·ªâ Email:</label>
            <input id="email" type="email" class="form-control" placeholder="an@example.com">
        </div>

        <div class="d-flex gap-2">
            <button id="btnSave" class="btn btn-primary px-4" onclick="saveStudent()">Th√™m m·ªõi</button>
            <button class="btn btn-secondary px-4" onclick="resetForm()">H·ªßy / L√†m m·ªõi</button>
        </div>
    </div>

<script>
// API tr·ªè v·ªÅ m√°y localhost c·ªßa b·∫°n
const API = "http://localhost:8080/api/students";

// 1. T·∫£i danh s√°ch sinh vi√™n
function loadStudents() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            let html = "";
            if (data.length === 0) {
                html = `<tr><td colspan="4" class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu sinh vi√™n.</td></tr>`;
            } else {
                data.forEach(s => {
                    html += `
                    <tr>
                        <td>${s.id}</td>
                        <td>${s.name}</td>
                        <td>${s.email}</td>
                        <td>
                            <button class="btn btn-warning btn-sm me-1" onclick="editStudent(${s.id}, '${s.name}', '${s.email}')">S·ª≠a</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent(${s.id})">X√≥a</button>
                        </td>
                    </tr>`;
                });
            }
            document.getElementById("studentTable").innerHTML = html;
        })
        .catch(err => {
            console.error("L·ªói:", err);
            document.getElementById("studentTable").innerHTML = 
                `<tr><td colspan="4" class="text-center text-danger">Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn Server API.</td></tr>`;
        });
}

// 2. L∆∞u th√¥ng tin (Th√™m m·ªõi ho·∫∑c C·∫≠p nh·∫≠t)
function saveStudent() {
    const id = document.getElementById("studentId").value;
    const student = {
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim()
    };

    if (!student.name || !student.email) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
    }

    const method = id ? "PUT" : "POST";
    const url = id ? `${API}/${id}` : API;

    fetch(url, {
        method: method,
        headers: { 
            "Content-Type": "application/json; charset=UTF-8" 
        },
        body: JSON.stringify(student)
    })
    .then(res => {
        if (res.ok) {
            alert(id ? "C·∫≠p nh·∫≠t th√†nh c√¥ng!" : "Th√™m m·ªõi th√†nh c√¥ng!");
            resetForm();
            loadStudents();
        } else {
            alert("L·ªói khi g·ª≠i d·ªØ li·ªáu l√™n Server!");
        }
    })
    .catch(err => alert("Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server: " + err.message));
}

// 3. ƒê·ªï d·ªØ li·ªáu v√†o Form khi nh·∫•n n√∫t S·ª≠a
function editStudent(id, name, email) {
    document.getElementById("studentId").value = id;
    document.getElementById("name").value = name;
    document.getElementById("email").value = email;
    
    document.getElementById("formTitle").innerText = "S·ª≠a th√¥ng tin sinh vi√™n (ID: " + id + ")";
    document.getElementById("btnSave").innerText = "L∆∞u c·∫≠p nh·∫≠t";
    document.getElementById("btnSave").className = "btn btn-success px-4";
}

// 4. X√≥a sinh vi√™n
function deleteStudent(id) {
    if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a sinh vi√™n n√†y?")) {
        fetch(`${API}/${id}`, { method: "DELETE" })
            .then(res => {
                if (res.ok) loadStudents();
                else alert("X√≥a th·∫•t b·∫°i!");
            });
    }
}

// 5. T√¨m ki·∫øm theo t√™n (H·ªó tr·ª£ ti·∫øng Vi·ªát)
function searchStudent() {
    const name = document.getElementById("search").value;
    if (!name) {
        loadStudents();
        return;
    }
    
    // S·ª≠ d·ª•ng encodeURIComponent ƒë·ªÉ x·ª≠ l√Ω d·∫•u ti·∫øng Vi·ªát tr√™n thanh URL
    fetch(`${API}/search?name=${encodeURIComponent(name)}`)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.email}</td>
                    <td>
                        <button class="btn btn-warning btn-sm me-1" onclick="editStudent(${s.id}, '${s.name}', '${s.email}')">S·ª≠a</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteStudent(${s.id})">X√≥a</button>
                    </td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

// 6. Reset Form v·ªÅ tr·∫°ng th√°i th√™m m·ªõi
function resetForm() {
    document.getElementById("studentId").value = "";
    document.getElementById("name").value = "";
    document.getElementById("email").value = "";
    document.getElementById("formTitle").innerText = "Th√™m sinh vi√™n m·ªõi";
    document.getElementById("btnSave").innerText = "Th√™m m·ªõi";
    document.getElementById("btnSave").className = "btn btn-primary px-4";
}

// Kh·ªüi ch·∫°y khi t·∫£i trang
loadStudents();
</script>
</body>
</html>